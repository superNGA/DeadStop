#include <windows.h>
#include <iostream>
#include <winnt.h>
#include <ntstatus.h>


///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
LONG CALLBACK CrashHandler(PEXCEPTION_POINTERS pException)
{
    PEXCEPTION_RECORD pExpRecords = pException->ExceptionRecord;
    PCONTEXT          pContext    = pException->ContextRecord;

    printf("Code : 0x%08lX, iFlags : %lu, Adrs : %p\n", pExpRecords->ExceptionCode, pExpRecords->ExceptionFlags, pExpRecords->ExceptionAddress);

    return EXCEPTION_CONTINUE_SEARCH;
}


///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
void Init()
{
    AddVectoredExceptionHandler(1, CrashHandler);
}


///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
void BadFn()
{
    int* pShit = nullptr;
    *pShit = 10;
    return;
}


///////////////////////////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////
int main(void)
{
    Init();

    BadFn();

    return 0;
}
